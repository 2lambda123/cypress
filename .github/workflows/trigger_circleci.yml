name: "Trigger CircleCi Pipeline"

on:
  - push
  # pull_request_target:
  #   types:
  #     - opened
  #     - synchronize
  #     - ready_for_review

jobs:
  main:
    name: Trigger CircleCi Pipeline when PR is ready for review
    runs-on: ubuntu-latest
    steps:
      - name: Step
        shell: bash
        env:
          CIRCLE_TOKEN: ${{ secrets.CIRCLE_TOKEN }}
        run: |
          if [[ "${CIRCLE_TOKEN}" == "" ]]; then
            echo "The CIRCLE_TOKEN is unset. Cannot trigger pipeline..."
            exit 1;
          fi

          echo "Determine whether or not to trigger CircleCi pipeline"
          printenv

          echo " - repo $BASE_ORG_AND_REPO"
          # echo " - branch $GITHUB_HEAD_REF"
          # echo " - pull $PULL_ID"
          echo " - event $EVENT"

          # BRANCH="$GITHUB_HEAD_REF"

          # if [[ "$BASE_ORG_AND_REPO" === "" "$BASE_ORG_AND_REPO" != "cypress-io/cypress" ]]; then
          #   echo "Triggering CircleCi pipeline for outside contributor."
          #   BRANCH="pull/$PULL_ID/head"
          # fi

          # response=$(curl -X POST https://circleci.com/api/v2/project/github/cypress-io/cypress/pipeline \
          #   --header "Circle-Token:$CIRCLE_TOKEN" \
          #   --header "content-type:application/json" \
          #   --data "{\"branch\":\"$BRANCH\"}" \
          #   --silent
          # )

          # echo "$response"

          # if [ "$(jq 'has("message")' <<< $response )" == "true" ]; then
          #   echo "Error triggering pipeline..."
          #   exit 1;
          # fi
